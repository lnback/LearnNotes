# 计算机网络

## TCP
最常见的TCP三次握手、四次挥手不多说了，基础中的基础。
### 为什么TCP是三次握手才能确立连接？
这个问题可以有两种角度来回答 
1. TCP只有确立了双方的接收发送能力才能连接。
2. 还有一种在下面讨论一下

TCP中的连接指的是：用于保证可靠性和流控制机制的信息，包括Socket、序列号以及窗口大小叫做连接。

也就是说，建立一个TCP连接就是通信的双方需要对上述的三种信息达成共识，连接中的一对Socket是有互联网地址标识符和端口组成的；窗口大小主要用来做流控制；最后的序列号是用来追踪 发起方 发送的数据包序号，接收方 可以通过序列号向 发送方 确认某个数据包的成功接收。

主要是有三个原因：
- 通过三次握手才能阻止重复历史连接的初始化
- 通过三次握手才能对通信双方的初始序列号进行初始化
- 讨论其他次数握手建立连接的可能性

#### 历史连接
为了阻止历史的重复连接初始化造成的混乱问题，防止使用TCP协议通信的双方建立了错误的连接。

![](https://cdn.jsdelivr.net/gh/lnback/imgbed/img/20210109145106.png)

有一个场景：如果通信双方的次数只有两次，那么发送方一旦发出建立连接的请求之后就没有办法撤回这一次请求，如果在网络状况复杂或者较差的网络中，发送方连续发送多次建立连接的请求，如果TCP建立连接只能通信两次，难么接收方只能选择接受或者拒绝发送方发起的请求，因为接收方并不清楚这一次请求是不是由于网络拥堵而早早过期的连接
。

所以TCP使用三次握手来建立连接并在连接引入了RST这一标志位，接收方收到请求时会将发送方发来的SEQ+1发送给对方，这时由发送方来判断当前连接是否是历史连接：
- 如果是历史连接，也就是SEQ过期或者超市，则会发送RST终止。
- 如果不是，则会发送ACK建立连接。

使用三次握手和 RST 控制消息将是否建立连接的最终控制权交给了发送方，因为只有发送方有足够的上下文来判断当前连接是否是错误的或者过期的，这也是 TCP 使用三次握手建立连接的最主要原因。
#### 初始化序列号
另一个使用三次握手的重要的原因就是通信双方都需要获得一个用于发送信息的初始化序列号，作为一个可靠的传输层协议，TCP 需要在不稳定的网络环境中构建一个可靠的传输层，网络的不确定性可能会导致数据包的缺失和顺序颠倒等问题，常见的问题可能包括：

- 数据包被发送方多次发送造成数据的重复；
- 数据包在传输的过程中被路由或者其他节点丢失；
- 数据包到达接收方可能无法按照发送顺序；

为了解决上述这些可能存在的问题，TCP 协议要求发送方在数据包中加入『序列号』字段，有了数据包对应的序列号，我们就可以：

- 接收方可以通过序列号对重复的数据包进行去重；
- 发送方会在对应数据包未被 ACK 时进行重复发送；
- 接收方可以根据数据包的序列号对它们进行重新排序；

序列号在 TCP 连接中有着非常重要的作用，初始序列号作为 TCP 连接的一部分也需要在三次握手期间进行初始化，由于 TCP 连接通信的双方都需要获得初始序列号，所以它们其实需要向对方发送 SYN 控制消息并携带自己期望的初始化序列号 SEQ，对方在收到 SYN 消息之后会通过 ACK 控制消息以及 SEQ+1 来进行确认。
#### 为什么不是两次四次或者更多次？
- 为什么不是两次？
    两次不能确保双方的接收发送能力

- 为什么不是四次或更多次？
    因为三次已经够了，再多也不能优化反而会增加负担，这个问题也够傻了。
### 为什么TCP是四次挥手才能断开连接？

### TCP怎么保证可靠传输

### TCP中的粘包拆包
#### 粘包、拆包
在一个网络通信中，如果一个客户端连续不断的向服务器发送数据包，服务端可能出现两个数据包粘在一起的情况或者是接受到的包不完整，这就是粘包、拆包。

TCP是属于传输层的协议，并且TCP是基于流传送的，所以会发生这种现象。而UDP是基于报文传输的。

#### 原因
- 要发送的数据大于TCP缓冲区剩余空间大小，发生拆包。
- 待发送的数据大于设定的传输数据的最大长度，发生拆包
- 待发送的数据小于设定的传输数据的大小，并且有多次流写入缓冲区，发生粘包
- 接受数据没有及时读取缓冲区中的数据，发生粘包。
#### 解决办法
- 发送端每次发送数据的时候添加一个包首部，首部中含有数据包的长度
- 在每个数据包之间添加分界线，比如一个特殊符号。根据边界信息对包进行拆分
### 基于流传输和基于报文传输
### TCP的拥塞控制
### TCP中的滑动窗口和流量控制
### TCP的ARQ协议
#### 停止等待ARQ
#### 连续ARQ
## UDP

## HTTP1/HTTP2/HTTPS

## 其他协议

### DNS

### ARP
