# IPC 进程间通信

## 第一类：传统Unix通信机制
### 1.管道/匿名管道（pipe）
- 管道是半双工的，数据只能向一个方向流动；需要双方通信时，需要建立起两个管道
- 只能用于父子进程或者兄弟进程之间
- 单独构成了一种独立的文件系统
- 数据的读出和写入：一个进程向管道中写的内容被管道另一端的进程读出。写入的内容每次都添加在管道缓冲区的末尾，并且每次都是从缓冲区的头部读出数据。

**管道的实质**：
管道的实质就是一个内核缓冲区，进程以先进先出的方式从缓冲区存取数据，管道一端的进程顺序的将数据写入缓冲区，另一端的进程则顺序的读取数据。

该缓冲区可以看做一个循环队列，读和写的位置都是自动增长的，不能随意改变，一个数据只能被读一次，读出来以后在缓冲区就不复存在了。

当缓冲区读空或者写满时，有一定的规则控制相应的读进程或者写进程进入等待队列，当空的缓冲区有新数据写入或者满的缓冲区有数据读出来时，就唤醒等待队列中的进程继续读写。

**管道的局限**：
管道主要局限性正体现在它的特点上：
- 只支持单向数据流
- 只能用于具有亲缘关系的进程之间
- 没有名字
- 管道的缓冲区有限
- 管道所传送的是无格式字节流，这就要求管道的读出方和写入方必须事先约定好数据的格式。
### 2.有名管道（FIFO）
匿名管道，由于没有名字，只能用于亲缘关系的进程间通信。为了克服这个缺点，提出了有名管道（FIFO）。

有名管道提供了一个路径名，即使有名管道创建的进程不存在亲缘关系的进程，只要可以访问该路径，就能够彼此通过有名管道进行通信。值得注意的是，有名管道遵循FIFO，和匿名管道的读写机制一样。它们都不支持文件定位操作。有名管道的名字存在于文件系统中，内容放在内存中。

### 3.信号（signal）
- 信号是linux中用于进程间互相通信或者操作的一种机制，信号可以在任何时候发给某一进程，无需知道该进程的状态。
- 如果该进程当前不在执行状态，则该信号就由内核保存起来，直到该进程恢复执行并传递给他。
- 如果一个信号被设置为阻塞，则该信号的传递被延迟，直到其阻塞被取消时才被传递给进程

> 常用的信号
> SIGINT：程序终止信号。程序运行过程中，`Ctrl+C`键产生该信号
> SIGQUIT

**信号来源**
信号是软件层次上对中断机制的一种模拟，是一种异步通信方式，信号可以在用户空间进程和内核之间直接交互，内核可以利用信号来通知用户空间的进程发生了哪些系统时间，信号时间主要有两个来源。
- 硬件来源：用户按键输入`Ctrl+C`退出、硬件异常如无效的存储访问等。
- 软件终止：终止进程信号、其他进程调用kill函数、软件异常产生信号。

**信号生命周期和处理流程**
1.  信号被某个进程产生，并设置此信号传递的对象（PID），然后传递给操作系统
2.  操作系统根据接收进程的设置（是否阻塞）而选择性的发送给接收者，如果接收者阻塞该信号（该信号能被阻塞），操作系统暂存该信号，不传递。直到该进程解除了对此信号的阻塞（如果对应进程已经退出，则丢弃此信号），如果对应进程没有阻塞，操作系统将传递此信号。
3.  目的进程接收到此信号后，将根据当前进程对此信号设置的预处理方式，暂时终止当前代码的执行，保护上下文、转而执行中断服务程序，执行完成后再恢复到中断的位置。

### 4.消息队列（Message）
- 消息队列是放在内核中的消息链表，每个消息队列由消息队列标识符表示
- 与管道不同的是消息队列放在内核中，只有在内核重启（系统重启）或者显式的删除一个消息队列时，该消息队列才会被真正的删除。
- 另外与管道不同的是，消息队列在某个进程往一个队列写入消息之前，并不需要另外某个进程在该对列上等待消息的到达。

### 5.共享内存
5. 共享内存(share memory)

- 使得多个进程可以可以直接读写同一块内存空间，是最快的可用IPC形式。是针对其他通信机制运行效率较低而设计的。
- 为了在多个进程间交换信息，内核专门留出了一块内存区，可以由需要访问的进程将其映射到自己的私有地址空间。进程就可以直接读写这一块内存而不需要进行数据的拷贝，从而大大提高效率。
- 由于多个进程共享一段内存，因此需要依靠某种同步机制（如信号量）来达到进程间的同步及互斥。

### 6.信号量（）
信号量是一个计数器，用于多进程对共享数据的访问，信号量的意图在于进程间同步。
为了获得共享资源，进程需要执行下列操作：
1.  创建一个信号量：这要求调用者指定初始值，对于二值信号量来说，它通常是1，也可是0。
2.  等待一个信号量：该操作会测试这个信号量的值，如果小于0，就阻塞。也称为P操作。
3.  挂出一个信号量：该操作将信号量的值加1，也称为V操作。

为了正确地实现信号量，信号量值的测试及减1操作应当是原子操作。为此，信号量通常是在内核中实现的。Linux环境中，有三种类型：Posix（可移植性操作系统接口）有名信号量（使用Posix IPC名字标识）、Posix基于内存的信号量（存放在共享内存区中）、System V信号量（在内核中维护）。这三种信号量都可用于进程间或线程间的同步。


### 7.套接字（socket）
套接字是一种通信机制，凭借这种机制，客户/服务器（即要进行通信的进程）系统的开发工作既可以在本地单机上进行，也可以跨网络进行。也就是说它可以让不在同一台计算机但通过网络连接计算机上的进程进行通信。

socket是支持TCP/IP的网络通信的基本操作单元，可以看做是不同主机之间的进程进行双向通信的端点，简单的说就是通信的良方的一种约定，用套接字中的相关函数来完成通信过程。

**套接字特性**：

